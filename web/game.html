<!DOCTYPE html>

<link rel="import" href="board.html">
<link rel="import" href="player.html">
<link rel="import" href="history.html">

<polymer-element name="risk-game">
  <template>
    <link rel="stylesheet" href="css/risk.css">
    <link rel="stylesheet" href="packages/bootstrap_for_pub/3.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="packages/bootstrap_for_pub/3.1.0/css/bootstrap-theme.min.css">

    <style>
      #avatars {
        text-align: center;
        padding: 0;
        margin: 1em 0;
      }
      #avatars risk-player-vignette {
        display: inline-block;
      }
    </style>

    <section class="container-fluid">
      <div class="row">
        <!-- Risk Board -->
        <risk-board id='board' game="{{ game }}" playerId="{{ playerId }}" class="col-md-8"
          on-attack="{{ attack }}"
          on-move="{{ move }}"
          on-selection="{{ selection }}"></risk-board>
        <div class="col-md-4">

          <template if='{{ !game.started && game.players.length >= 2 }}'>
            <div style='text-align: center; padding: 1em;'>
              <button on-click='{{ startGame }}'>Start Game</button>
            </div>
          </template>

          <!-- Players List -->
          <div id="avatars">
            <template repeat="{{ player in game.players.values }}">
              <risk-player-vignette player="{{ player }}" active="{{ player.playerId == game.activePlayerId }}"></risk-player-vignette>
            </template>
          </div>

          <!-- my actions -->
          <template if='{{ playerId == game.activePlayerId }}'>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title">It's up to you !</h3>
              </div>
              <div class="panel-body" style="text-align: center;">
                <template if='{{ game.turnStep == "REINFORCEMENT" }}'>
                  <h3>Reinforcement</h3>
                  <p>Select one of your country to add one of the <strong>{{ game.players[playerId].reinforcement }}</strong> army left.</p>
                </template>
                <template if='{{ game.turnStep == "ATTACK" }}'>
                  <h3>Attack</h3>
                  <template if='{{ pendingMove == null }}'>
                    <p>Select a country from which you want to engage a battle.</p>
                    <button on-click="{{ endAttack }}">End of attacks</button>
                  </template>
                </template>
                <template if='{{ game.turnStep == "FORTIFICATION" }}'>
                  <h3>Fortification</h3>
                  <template if='{{ pendingMove == null }}'>
                    <p>Select a country from which you want to perform the last move to make ofr this turn.</p>
                    <button on-click="{{ endTurn }}">End of my turn</button>
                  </template>
                </template>
                <template if='{{ pendingMove != null }}'>
                  <div style='text-align: center; padding: 1em;'>
                    <p>How many armies do you want to move from <strong>{{ pendingMove.from }}</strong> to <strong>{{ pendingMove.to }}</strong>?</p>
                    <input type="range" value="{{ armiesToMove | asInteger }}" min="1" max="{{ pendingMove.maxArmies }}" />
                    <button on-click='{{ moveArmies }}'>Move {{ armiesToMove }} armies</button>
                  </div>
                </template>
              </div>
            </div>
          </template>

          <risk-history game="{{ game }}"></risk-history>
        </div>
      </div>
    </section>
  </template>

  <script type="application/dart" src="game.dart"></script>
</polymer-element>

